# EC2 Autoscaling
## 스케일링
* 인스턴스 혹은 컴퓨팅 파워를 늘리는 것
### Vertical Scale(Scale up) = 수직적 스케일링
* 인스턴스 크기 자체를 늘리는 것
    * 4GB의 CPU가 있을 때 1GB의 CPU가 필요하다면, 4GB -> 16GB의 CPU로 늘리는 것
* 비용이 너무 많이 듦(크기가 커질수록 비용이 기하급수적으로 증가함)
### Horizontal Scale(scale out)
* 인스턴스 규모를 늘리는 것
    * 4GB의 CPU가 있을 때 16GB의 CPU가 필요하다면, 4GB를 4개로 놀리는 것
* 비용이 합리적이다.

## AWS Auto Scaling
* 애플리케이션을 모니터링하고 용량을 자동으로 조정하여, 최대한 저렴한 비용으로 안정적이고 예측 가능한 성능을 유지하는 것
*  즉, 자동으로 스케일링 서비스를 해주는 것

### 종류
* <span style="background:#FFE6E6">EC2 Auto Scaling (여기서 다룰 것)</span>
* DDB Auto Scaling
* Sot Fleet Autoo Scaling
* Aurora Auto Scaling
* ECS Auto Scaling

### EC2 Auto Scaling의 목표
* 정확한 수의 EC2 인스턴스를 보유하도록 보장하기 위해
    * 그룹의 최소 인스턴스 숫자 및 최대 인스턴스 숫자를 설정한다.
        * 최소 숫자 이하로 내려가지 않도록 인스턴스 갯수를 유지(이하의 경우 자동으로 인스턴스 추가)
        * 최대 숫자 이상 늘어나지 않도록 인스턴스 갯수를 유지(이상의 경우 자동으로 인스턴스 삭제)
    * 다양한 스케일링 정책 적용 가능
        * ex) CPU의 부하에 따라 인스턴스 크기 조정
    * 가용 영역에 인스턴스를 골고루 분산시켜서 서비스 장애를 예방한다.

### EC2 Auto Scaling의 구성
#### 시작 구성(launch configurations) / 시작 템플릿(launch template)
**무엇을 실행시킬 것인가? (EC2를 자동으로 추가해야할 경우 어떤 구성으로 되어있는 EC2를 추가하면 되는 지 설정하는 것**
* EC2의 타입, 사이즈
* AMI
* 보안 그룹, Key, IAM
* 유저 데이터
#### 모니터링
**언제 실행시킬 것인가? + 상태 확인**
* ex) CPU 점유율이 일정 %을 넘어섰을 때 EC2를 추가로 실행, EC2 2개 이상이 필요한 스택에서 하나가 죽었을 때 추가로 실행 등
* CloudWatch (and/or) ELB(Elastic Load Balance) 와 연계


#### 설정
**얼마나 어떻게 실행시킬 것인가?**
* 최대/최소/원하는 인스턴스 갯수
* ELB와 연동 등

## 실습하기
### 1. 시작 템플릿 만들기
* Autoscaling 그룹에서 어떤 인스턴스를 어떻게 올릴 것인지를 정의하는 템플릿
1. 인스턴스 > 시작 템플릿 화면 이동 후 '시작 템플릿 생성' 버튼 클릭
2. 이름, 설명 입력
3. 'EC2 Auto Scaling에 사용할 수 있는 템플릿을 설정하는 데 도움이 되는 지침 제공' 선택
4. AMI 선택 (앞서 만든 EC2의 AMI와 동일한 것 선택)
5. 너트워크 설정 > 고급 네트워크 구성 > 네트워크 인터페이스 추가
    * 네트워크 인터페이스 : 새 인터페이스
    * 퍼블릭 IP 자동 할당 : 활성화
    * 보안 그룹 : default
    * 종료 시 삭제 : 예
6. 시작 템플릿 생성 클릭

### 2. Auto Scaling 그룹 만들기
* 시작 템플릿 생성 성공 페이지로 넘어오면,
1. Auto Scaling 그룹 생성 클릭
2. Auto Scaling 그룹 이름 입력
3. 시작 템플릿 방금 생성한 거 선택 > 다음
4. VPC, 가용 영역 및 서브넷 선택
    *  VPC: 기본으로 선택되어 있음
    * 가용 영역 및 서브넷 : 인스턴스를 분배시켜 저장할 가용영역 지정(a~d 전부 다 선택함)
5. 다음 > (고급 옵션)다음
6. 원하는 용량, 최소 용량, 최대 용량 선택 > 다음 > (알림)다음
    * 실습을 위해 모두 2로 설정
7. 태그 추가
    * 이 오토스케일링이 만든 인스턴스에 모두 적용됨
8. 다음 > Auto Scaling 그룹 생성

### 3. Auto Scaling 생성 확인 및 활동 테스트
* 갓 생성한 Auto Scaling의 상태가 `용량 업데이트 중` 임을 확인
    * why? 오토 스케일링 생성 시 원하는 용량, 최소 용량을 2로 맞추었는데, 현재 인스턴스는 0개였기 때문에 오토스케일링이 인스턴스 2개를 생성하는 작업을 하느라 용량 업데이트 중이다.
    * 이 오토 스케일링을 클릭해서 `인스턴스`와 `활동`을 들어가 보면 위 작업에 대한 내용 확인 가능
1. 인스턴스 하나 종료 하기
    * 인스턴스 > 인스턴스 하나 선택 > 인스턴스 종료 > 새로고침 버튼 클릭
2. 오토 스케일링에서 인스턴스 상태 `Unhealthy`확인
3. 활동 > 작업 기록에서 인스턴스 하나가 삭제됨과 동시에 하나가 다시 생성되는 걸 확인
4. 오토 스케일링이 생성한 인스턴스 정보에서 태그를 확인해보면, 내가 오토 스케일링을 생성할 때 추가했던 태그가 들어간 걸 확인

### 4. Auto Scaling 원하는 용량, 최소 용량 변경해보기
1. Auto Scaling 선택 > 세부 정보 > 편집
2. 원하는 용량, 최소 용량 : 1로 변경 > 업데이트
3. 인스턴스를 확인해보면, 활성화된 인스턴스가 1개로 줄어들어있다.


## 실습을 마치며
### Auto Scaling의 원하는 용량과 최소 용량을 꼭 0으로 변경해주자!
* 만약 Auto Scaling을 편집하는 것이 아닌 EC2를 직접 삭제할 경우 계속 새로운 인스턴스가 생성될 것임




### Reference
https://www.youtube.com/playlist?list=PLfth0bK2MgIan-SzGpHIbfnCnjj583K2m